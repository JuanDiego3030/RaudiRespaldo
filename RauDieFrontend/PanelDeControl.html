{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Panel de Control - Gestión de Proyectos</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="{% static 'img/favicon.png' %}" rel="icon">
  <link href="{% static 'img/apple-touch-icon.png' %}" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static 'css/main.css' %}" rel="stylesheet">

  <style>
    .btn-small {
      padding: 0.25rem 0.5rem; /* Ajustar el padding para botones más pequeños */
      font-size: 0.875rem; /* Tamaño de fuente más pequeño */
      margin-right: 0.5rem; /* Margen a la derecha para separación */
    }
  </style>
</head>

<body class="dashboard-page">

  <!-- Header -->
  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

      <!-- Enlace al Panel de Control -->
      <a href="{% url 'panel_control' %}" class="logo d-flex align-items-center">
        <img src="{% static 'img/nav img.png' %}" class="sitename" alt="Logo de RauDie">
        <h1>RAUDIE</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="#dashboard" class="active">Panel de Control</a></li>
          <li><a href="#projects">Proyectos</a></li>
          <li><a href="#tasks">Tareas</a></li>
          <li><a href="#team">Equipo</a></li>
          <li><a href="#reports">Reportes</a></li>
          <li><a href="#settings">Configuración</a></li>
        </ul>
      </nav>

    </div>
  </header><!-- End Header -->

  <main class="main">

    <!-- Mostrar Mensajes de Django -->
    <div class="container mt-3">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
          </div>
        {% endfor %}
      {% endif %}
    </div>

    <!-- Dashboard Overview -->
    <section id="dashboard" class="dashboard section">
      <div class="container">
        <div class="row text-center mb-4">
          <div class="col-lg-12">
            <h2>Panel de Control</h2>
            <p>Visión general de los proyectos y progreso actual.</p>
          </div>
        </div>
      </div>
    </section>
    <!-- End Dashboard Overview -->

    <!-- Project Management Section -->
    <section id="projects" class="projects section">
      <div class="container">
        <h3>Proyectos Actuales</h3>

        <div class="row gy-4">
          {% for proyecto in proyectos %}
            <div class="col-lg-4">
              <div class="card rounded shadow-sm">
                <div class="card-body">
                  <h4 class="card-title">{{ proyecto.nombre }}</h4>
                  <p><strong>Cliente:</strong> {{ proyecto.cliente }}</p>
                  <p><strong>Descripción:</strong> {{ proyecto.descripcion }}</p>
                  <p><strong>Requerimientos:</strong> {{ proyecto.requerimientos }}</p>
                  <p><strong>Tipo de Proyecto:</strong> {{ proyecto.tipo }}</p>
                  <p><strong>Fecha de Inicio:</strong> {{ proyecto.fecha_inicio }}</p>

                  <!-- Estatus del proyecto con color dinámico -->
                  <p><strong>Estatus:</strong>
                    <span class="badge 
                      {% if proyecto.estado == 'Completado' %}bg-success{% elif proyecto.estado == 'En progreso' %}bg-warning{% elif proyecto.estado == 'Pendiente' %}bg-danger{% else %}bg-secondary{% endif %}">
                      {{ proyecto.estado }}
                    </span>
                  </p>

                  <!-- Botones para cambiar estatus y eliminar -->
                  <div class="d-flex justify-content-between">
                    <button class="btn btn-primary btn-small" data-bs-toggle="modal" data-bs-target="#modal-{{ proyecto.id }}">Cambiar Estado</button>
                    <form method="POST" action="{% url 'panel_control' %}" onsubmit="return confirm('¿Estás seguro de que deseas eliminar este proyecto?');">
                      {% csrf_token %}
                      <input type="hidden" name="proyecto_id" value="{{ proyecto.id }}">
                      <button class="btn btn-danger btn-small" type="submit" name="eliminar_proyecto">Eliminar</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modal para cambiar estatus -->
            <div class="modal fade" id="modal-{{ proyecto.id }}" tabindex="-1" aria-labelledby="modalLabel-{{ proyecto.id }}" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel-{{ proyecto.id }}">Cambiar Estado del Proyecto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                  </div>
                  <div class="modal-body">
                    <form method="POST" action="{% url 'panel_control' %}">
                      {% csrf_token %}
                      <input type="hidden" name="proyecto_id" value="{{ proyecto.id }}">
                      <label for="estado">Estado del proyecto:</label>
                      <select name="estado" id="estado" required>
                          <option value="Planeando" {% if proyecto.estado == "Planeando" %}selected{% endif %}>Planeando</option>
                          <option value="En progreso" {% if proyecto.estado == "En progreso" %}selected{% endif %}>En progreso</option>
                          <option value="Completado" {% if proyecto.estado == "Completado" %}selected{% endif %}>Completado</option>
                      </select>
                      <button type="submit" name="cambiar_estatus" class="btn btn-secondary mt-2">Actualizar Estatus</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>

          {% empty %}
            <div class="col-lg-12 text-center">
              <p>No hay proyectos registrados actualmente.</p>
            </div>
          {% endfor %}
        </div>
      </div>
    </section>
    <!-- End Project Management Section -->

    <!-- Task Management Section -->
    <section id="tasks" class="tasks section">
      <div class="container">
        <h3>Tareas Recientes</h3>
        <div class="row gy-4">
          
          <!-- Tarea 1 -->
          <div class="col-lg-4">
            <div class="card rounded shadow-sm">
              <div class="card-body">
                <h4 class="card-title">Tarea 1</h4>
                <p class="card-text">Descripción de la tarea 1.</p>
                <span class="badge bg-success mb-3">Completada</span>
                <div class="dropdown">
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButtonTask1" data-bs-toggle="dropdown" aria-expanded="false">
                    Cambiar Estatus
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="dropdownMenuButtonTask1">
                    <li><a class="dropdown-item" href="#">Completada</a></li>
                    <li><a class="dropdown-item" href="#">En progreso</a></li>
                    <li><a class="dropdown-item" href="#">Pendiente</a></li>
                    <li><a class="dropdown-item" href="#">Cancelada</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <!-- Fin Tarea 1 -->

          <!-- Tarea 2 -->
          <div class="col-lg-4">
            <div class="card rounded shadow-sm">
              <div class="card-body">
                <h4 class="card-title">Tarea 2</h4>
                <p class="card-text">Descripción de la tarea 2.</p>
                <span class="badge bg-warning mb-3">En progreso</span>
                <div class="dropdown">
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButtonTask2" data-bs-toggle="dropdown" aria-expanded="false">
                    Cambiar Estatus
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="dropdownMenuButtonTask2">
                    <li><a class="dropdown-item" href="#">Completada</a></li>
                    <li><a class="dropdown-item" href="#">En progreso</a></li>
                    <li><a class="dropdown-item" href="#">Pendiente</a></li>
                    <li><a class="dropdown-item" href="#">Cancelada</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <!-- Fin Tarea 2 -->

          <!-- Tarea 3 -->
          <div class="col-lg-4">
            <div class="card rounded shadow-sm">
              <div class="card-body">
                <h4 class="card-title">Tarea 3</h4>
                <p class="card-text">Descripción de la tarea 3.</p>
                <span class="badge bg-danger mb-3">Pendiente</span>
                <div class="dropdown">
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButtonTask3" data-bs-toggle="dropdown" aria-expanded="false">
                    Cambiar Estatus
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="dropdownMenuButtonTask3">
                    <li><a class="dropdown-item" href="#">Completada</a></li>
                    <li><a class="dropdown-item" href="#">En progreso</a></li>
                    <li><a class="dropdown-item" href="#">Pendiente</a></li>
                    <li><a class="dropdown-item" href="#">Cancelada</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <!-- Fin Tarea 3 -->

        </div>
      </div>
    </section>
    <!-- End Task Management Section -->

    <!-- Footer -->
    <footer id="footer" class="footer">
      <div class="container">
        <div class="row text-center">
          <div class="col-lg-12">
            <p>&copy; 2023 RAUDIE. Todos los derechos reservados.</p>
          </div>
        </div>
      </div>
    </footer><!-- End Footer -->

  </main>

  <!-- Vendor JS Files -->
  <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

</body>

</html>
